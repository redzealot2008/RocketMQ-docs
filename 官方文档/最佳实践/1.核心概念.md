## 核心概念

![RocketMQ模型][1]

根据上述模式，我们可以深入了解有关消息系统设计的一些主题：
- 消费者并发
- 消费者热点问题
- 消费者负载均衡
- 消息路由器
- 连接复用
- 金丝雀部署

## 生产者

生产者将业务应用系统生成的消息发送给代理。RocketMQ提供了多种发送模式：同步，异步和单向。

#### 生产者组
具有相同角色的生产者分组在一起。如果原始生产者在事务之后崩溃，则代理可以联系同一生产者组的不同生产者实体来提交或回滚事务。

**警告：** 考虑到提供的生产者在发送消息方面足够强大，每个生产者组只允许一个实例来避免生产者实例的不必要的初始化。

## 消费者

消费者从代理服务器拉取消息并将其送入应用程序中。从用户应用程序的角度，提供两种类型的消费者：

#### PullConsumer
Pull Consumer主动拉取代理服务器的消息。一旦一批消息被拉出，用户应用程序启动消费过程。

#### PushConsumer
Push consumer，在另一方面，封装了消息拉取，消费进程和维护其他工作，给终端用户留下了一个需实现的回调接口，这个接口在消息到达时执行。

#### 消费者组
与之前提到的生产者组类似，消费者将完全相同的角色分组在一起，并命名为消费者组。

消费者组是一个很好的概念，实现了消息消费方面的负载均衡和容错的目标，而且超级简单。

**警告：** 消费者组的消费者实例必须具有完全相同的主题订阅。

## 主题

主题是生产者传送消息和消费者拉取消息的类目。主题与生产者和消费者的关系非常宽松。具体来说，一个主题可能有零个，一个或多个生产者向其发送消息; 相反，生产者可以发送不同主题的消息。从消费者的角度来看，一个主题可能被零个，一个或多个消费者组订阅。同样，一个消费者组也可以订阅一个或多个主题，只要该组的实例保持其订阅一致。

## 消息

消息是要传递的信息。消息必须有一个主题，可以解释为邮寄信件的地址。消息还可以具有一个可选的标记和额外的键值对。例如，您可以为消息设置业务密钥，并在代理服务器上查找消息以在开发过程中诊断问题。

#### 消息队列
主题分为一个或多个子主题，“消息队列”。

#### 标签
标签，换句话说子主题，为用户提供了额外的灵活性。使用标签，来自同一业务模块具有不同目的的消息可能具有相同的主题和不同的标签。标签将有助于保持您的代码干净和一致，标签也可以促进RocketMQ提供的查询系统。

#### 代理
代理是RocketMQ系统的主要组成部分。它接收来自生产者的消息，存储它们并准备处理消费者的拉取请求。它还存储消息相关的元数据，包括消费者组，消费进度偏移和主题/队列信息。

## 名称服务器

名称服务器担任路由信息提供者。生产者/消费者客户端查找主题以找到相应的代理列表。

## 消息模型

- 集群

- 广播

## 消息顺序

当使用DefaultMQPushConsumer时，您可以决定消费消息有序地还是并发地。

- 有序的  
    消费消息有序地意味着消息的消费顺序与消息被生产者发送到消息队列的顺序相同。如果您正在处理全局顺序是强制性的场景，请确保您使用的主题只有一个消息队列。

**警告：** 如果指定消费有序，消息消费的最大并发数就是消费者组订阅的消息队列的数量。

- 并发的  
    当并发消费消息时，消息消消费的最大并发数只受限于每个消费者客户端指定的线程池的大小。

**警告：** 在此模式下不再保证消息顺序。

[1]: http://onmer39jj.bkt.clouddn.com/17-10-23/55133682.jpg